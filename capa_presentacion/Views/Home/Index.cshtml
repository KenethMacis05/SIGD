@{
    ViewBag.Title = "Dashboard";
}

<div class="alert text-center mt-4" style="background-color: #F7F7F7; border: 1px #D2D2D2 solid " role="alert">
    <h2 class="fs-3">Dashboard</h2>
</div>

<div class="jumbotron">
    <h1 class="display-4">Bienvenido</h1>
    <p class="lead">@ViewBag.NombreUsuario</p>

    <!-- Mensaje de error -->
    @if (ViewBag.Mensaje != null)
    {
        <div class="alert alert-danger">
            @ViewBag.Mensaje
        </div>
    }

    <!-- Configuración de Tipos de Archivos Permitidos -->
    <div class="mt-4">
        <h3>Configuración de Tipos de Archivos Permitidos</h3>
        <div class="mb-3">
            <label for="tiposArchivos" class="form-label">Tipos de Archivos Permitidos:</label>
            <input type="text" id="tiposArchivos" class="form-control" placeholder=".jpg,.png,.pdf,.docx" />
        </div>
        <button class="btn btn-primary" id="guardarTiposArchivos">Guardar Cambios</button>
        <div id="mensajeTiposArchivos" class="mt-3"></div>
    </div>
</div>

<script>
    // Función para cargar los tipos de archivos permitidos
    function cargarTiposArchivos() {
        fetch('/Configuracion/ObtenerTiposArchivosPermitidos')
            .then(response => response.json())
            .then(data => {
                document.getElementById('tiposArchivos').value = data.tiposPermitidos || '';
            })
            .catch(error => {
                console.error('Error al cargar los tipos de archivos:', error);
            });
    }

    // Función para guardar los nuevos tipos de archivos permitidos
    document.getElementById('guardarTiposArchivos').addEventListener('click', function () {
        const nuevosTipos = document.getElementById('tiposArchivos').value;

        fetch('/Configuracion/ActualizarTiposArchivosPermitidos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nuevosTipos })
        })
            .then(response => response.json())
            .then(data => {
                const mensajeDiv = document.getElementById('mensajeTiposArchivos');
                mensajeDiv.textContent = data.mensaje;
                mensajeDiv.className = data.exito ? 'text-success' : 'text-danger';

                if (data.exito) {
                    cargarTiposArchivos(); // Recargar los tipos de archivos permitidos
                }
            })
            .catch(error => {
                console.error('Error al guardar los tipos de archivos:', error);
            });
    });

    // Cargar los tipos de archivos permitidos al cargar la página
    document.addEventListener('DOMContentLoaded', cargarTiposArchivos);
</script>